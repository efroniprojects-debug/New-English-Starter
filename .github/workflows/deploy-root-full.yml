name: Deploy Visual Root (CSS+Image+Avatar+JS)

on:
  workflow_dispatch:
  push:
    branches: [ main ]

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  build-visual-root:
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deploy.outputs.page_url }}

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Clean everything
        run: |
          rm -rf * .github || true
          mkdir -p .github/workflows

      - name: Create logo image (demo)
        run: |
          wget https://upload.wikimedia.org/wikipedia/commons/8/89/Portrait_Placeholder.png -O avatar.png

      - name: Create style.css at root
        run: |
          cat > style.css << 'EOF'
          body { background: #f8fafe; color: #222; font-family: Arial,sans-serif; }
          .box { max-width: 600px; margin:80px auto 0; box-shadow:0 0 20px #dde; border-radius:24px; background:#fcfcfc; padding:36px; }
          h1 { color:#0563bb; font-size:2.2em; text-align:center; }
          .avatar { display:block; margin:0 auto 16px; border-radius:50%; box-shadow:0 2px 8px #cdf; max-width:120px; }
          .btn { background:#0563bb; color:#fff; font-weight:bold; border:none; border-radius:16px; padding:1em 2em; margin:12px; cursor:pointer; }
          .btn:active { background:#044c8b;}
          .store-item { padding:8px; border-bottom:1px solid #efefef;}
          EOF

      - name: Create index.html at root
        run: |
          cat > index.html << 'EOF'
          <!DOCTYPE html>
          <html lang="he" dir="rtl">
          <head>
            <meta charset="UTF-8">
            <title>ABC Explorer - Visual Demo âœ“</title>
            <link rel="stylesheet" href="style.css">
            <script src="site.js"></script>
          </head>
          <body>
            <div class="box">
              <h1>ABC Explorer<br>××¢×¨×›×ª ×¤×¨×•×¤×™×œ, ××•×•×˜××¨, ×¤×¨×¡×™× ×•×œ×•×’×•</h1>
              <img src="avatar.png" alt="××•×•×˜××¨" class="avatar">
              <div style="text-align:center">
                <button class="btn" onclick="getGift()">×§×‘×œ ××ª× ×”!</button>
              </div>
              <h2 style="margin-top:2em">×§× ×™×•×ª ×‘×—× ×•×ª:</h2>
              <div class="store-item">×›×•×›×‘ ×–×”×‘ (15 × ×§×•×“×•×ª)</div>
              <div class="store-item">×¨×§×¢ ×™×¢×¨ (25 × ×§×•×“×•×ª)</div>
              <div class="store-item">×—×ª×•×œ ×•×™×¨×˜×•××œ×™ (50 × ×§×•×“×•×ª)</div>
            </div>
            <script>
              function getGift() {
                alert("ğŸ‰ ×§×™×‘×œ×ª ×›×•×›×‘ ×–×”×‘!");
              }
            </script>
          </body>
          </html>
          EOF

      - name: Create site.js at root
        run: |
          echo "window.ABC_VERSION='Root Visual OK';" > site.js

      - name: Setup Github Pages
        uses: actions/configure-pages@v4

      - name: Upload artifact for Github Pages
        uses: actions/upload-pages-artifact@v3
        with:
          path: '.'

      - name: Deploy to Github Pages
        id: deploy
        uses: actions/deploy-pages@v4
