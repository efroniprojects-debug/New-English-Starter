name: ABC English Explorer - Simple Deploy

on:
  workflow_dispatch:
  push:
    branches: [ main ]

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Clean Repository
        run: find . -mindepth 1 -maxdepth 1 ! -name '.git' ! -name '.github' -exec rm -rf {} +

      - name: Create Folders
        run: |
          mkdir -p assets/images assets/icons assets/sounds
          mkdir -p lessons/grade1 lessons/grade2 lessons/grade3 lessons/grade4 lessons/grade5 lessons/grade6
          mkdir -p css js components games

      - name: Create HTML
        run: |
          cat > index.html << 'ENDHTML'
<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ABC English Explorer</title>
<style>
body { 
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg, #4FC3F7, #29B6F6);
  color: white;
  margin: 0;
  padding: 20px;
  text-align: center;
}
.container { max-width: 800px; margin: 0 auto; }
.header { 
  background: rgba(255,255,255,0.1);
  padding: 30px;
  border-radius: 20px;
  margin-bottom: 30px;
}
.robot { font-size: 60px; margin-bottom: 20px; }
h1 { font-size: 40px; margin: 20px 0; }
.stats { display: flex; gap: 20px; margin: 30px 0; }
.stat { 
  background: rgba(255,255,255,0.15);
  padding: 20px;
  border-radius: 10px;
  flex: 1;
}
.grade-btn {
  background: rgba(255,255,255,0.2);
  border: none;
  color: white;
  padding: 15px 30px;
  margin: 10px;
  border-radius: 10px;
  cursor: pointer;
  font-size: 16px;
}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="robot">🤖</div>
    <h1>ABC English Explorer</h1>
    <p>פלטפורמה חינוכית ללימוד אנגלית</p>
  </div>
  
  <div class="stats">
    <div class="stat">
      <h3>192</h3>
      <p>יחידות לימוד</p>
    </div>
    <div class="stat">
      <h3>25+</h3>
      <p>משחקים</p>
    </div>
    <div class="stat">
      <h3>100%</h3>
      <p>חינמי</p>
    </div>
  </div>
  
  <div>
    <button class="grade-btn">כיתה א</button>
    <button class="grade-btn">כיתה ב</button>
    <button class="grade-btn">כיתה ג</button>
    <button class="grade-btn">כיתה ד</button>
    <button class="grade-btn">כיתה ה</button>
    <button class="grade-btn">כיתה ו</button>
  </div>
  
  <div style="margin-top: 40px; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 10px;">
    <h3>🚀 האתר בשלבי פיתוח</h3>
    <p>פלטפורמה מהפכנית ונגישה לכל ילד בישראל</p>
  </div>
</div>
</body>
</html>
ENDHTML

      - name: Create Manifest
        run: |
          cat > manifest.json << 'ENDJSON'
{
  "name": "ABC English Explorer",
  "short_name": "ABC Explorer",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#4FC3F7",
  "theme_color": "#4FC3F7"
}
ENDJSON

      - name: Create Service Worker
        run: |
          cat > sw.js << 'ENDJS'
const CACHE_NAME = 'abc-v1';
const urlsToCache = ['/', '/index.html', '/manifest.json'];
self.addEventListener('install', event => {
  event.waitUntil(
    caches.open(CACHE_NAME).then(cache => cache.addAll(urlsToCache))
  );
});
self.addEventListener('fetch', event => {
  event.respondWith(
    caches.match(event.request).then(response => response || fetch(event.request))
  );
});
ENDJS

      - name: Create Sample Data
        run: |
          cat > lessons/grade1/lesson1.json << 'ENDDATA'
{
  "id": "grade1_lesson1",
  "title": "אותיות A-C",
  "vocabulary": [
    {"word": "Apple", "hebrew": "תפוח"},
    {"word": "Ball", "hebrew": "כדור"},
    {"word": "Cat", "hebrew": "חתול"}
  ]
}
ENDDATA

      - name: Commit Changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add .
          git commit -m "Launch ABC English Explorer" || exit 0
          git push

      - name: Setup Pages
        uses: actions/configure-pages@v4

      - name: Upload Pages
        uses: actions/upload-pages-artifact@v3
        with:
          path: .

      - name: Deploy Pages
        id: deployment
        uses: actions/deploy-pages@v4

      - name: Success
        run: |
          echo "🎉 ABC English Explorer is LIVE!"
          echo "🌐 URL: ${{ steps.deployment.outputs.page_url }}"
