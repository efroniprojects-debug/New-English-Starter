name: ABC English Explorer - Final Deploy

on:
  workflow_dispatch:
  push:
    branches: [ main ]

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Clean Repository  
        run: |
          find . -mindepth 1 -maxdepth 1 ! -name '.git' ! -name '.github' -exec rm -rf {} +

      - name: Create Folders
        run: |
          mkdir -p assets/images assets/icons assets/sounds
          mkdir -p lessons/grade1 lessons/grade2 lessons/grade3 lessons/grade4 lessons/grade5 lessons/grade6
          mkdir -p css js components games

      - name: Generate HTML File
        run: |
          cat > index.html << 'EOF'
<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="ABC English Explorer - פלטפורמה חינוכית">
<meta name="theme-color" content="#4FC3F7">
<link rel="manifest" href="manifest.json">
<title>🤖 ABC English Explorer</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { 
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: linear-gradient(135deg, #4FC3F7 0%, #29B6F6 100%);
  min-height: 100vh; color: white; direction: rtl;
}
.container { max-width: 1200px; margin: 0 auto; padding: 2rem; }
.header { 
  background: rgba(255,255,255,0.1); backdrop-filter: blur(10px);
  border-radius: 20px; padding: 2rem; text-align: center; margin-bottom: 2rem;
}
.robot { font-size: 4rem; animation: bounce 2s infinite; }
@keyframes bounce {
  0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
  40% { transform: translateY(-20px); }
  60% { transform: translateY(-10px); }
}
h1 { font-size: 2.5rem; margin: 1rem 0; }
.subtitle { font-size: 1.2rem; opacity: 0.9; }
.stats {
  display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem; margin: 2rem 0;
}
.stat-card {
  background: rgba(255,255,255,0.15); padding: 1.5rem;
  border-radius: 15px; text-align: center;
}
.stat-number { font-size: 2rem; font-weight: bold; display: block; }
.grade-buttons {
  display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 1rem; margin-top: 2rem;
}
.grade-btn {
  background: rgba(255,255,255,0.2); border: none; color: white;
  padding: 1rem; border-radius: 10px; font-size: 1.1rem;
  cursor: pointer; transition: all 0.3s ease;
}
.grade-btn:hover {
  background: rgba(255,255,255,0.3); transform: translateY(-2px);
}
.features { margin: 2rem 0; }
.feature-grid {
  display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1rem;
}
.feature-card {
  background: rgba(255,255,255,0.1); padding: 1.5rem; border-radius: 15px;
}
.feature-icon { font-size: 2rem; margin-bottom: 1rem; }
@media (max-width: 768px) {
  .container { padding: 1rem; }
  .robot { font-size: 3rem; }
  h1 { font-size: 2rem; }
}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="robot">🤖</div>
    <h1>ABC English Explorer</h1>
    <p class="subtitle">פלטפורמה חינוכית מהפכנית ללימוד אנגלית</p>
    <p>192 יחידות לימוד מקצועיות לכיתות א׳-ו׳</p>
  </div>

  <div class="stats">
    <div class="stat-card">
      <span class="stat-number">192</span>
      <span>יחידות לימוד</span>
    </div>
    <div class="stat-card">
      <span class="stat-number">25+</span>
      <span>משחקים</span>
    </div>
    <div class="stat-card">
      <span class="stat-number">100%</span>
      <span>חינמי</span>
    </div>
    <div class="stat-card">
      <span class="stat-number">PWA</span>
      <span>אפליקציה</span>
    </div>
  </div>

  <div class="features">
    <h2 style="text-align: center; margin-bottom: 1rem;">🎯 מה מיוחד באתר?</h2>
    <div class="feature-grid">
      <div class="feature-card">
        <div class="feature-icon">🎮</div>
        <h3>משחקים אינטראקטיביים</h3>
        <p>זיכרון, בינגו, התאמות ועוד</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon">🎤</div>
        <h3>קריינות מובנית</h3>
        <p>הקשבה ודיבור לכל מילה</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon">👤</div>
        <h3>אווטאר אישי</h3>
        <p>התפתחות ומוטיבציה</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon">📊</div>
        <h3>מעקב התקדמות</h3>
        <p>דוחות להורים ומורים</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon">♿</div>
        <h3>נגישות מלאה</h3>
        <p>לכל הילדים ללא יוצא מן הכלל</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon">🌐</div>
        <h3>עובד בכל מקום</h3>
        <p>אונליין ואופליין</p>
      </div>
    </div>
  </div>

  <div class="grade-buttons">
    <button class="grade-btn" onclick="alert('כיתה א - בקרוב!')">כיתה א׳</button>
    <button class="grade-btn" onclick="alert('כיתה ב - בקרוב!')">כיתה ב׳</button>
    <button class="grade-btn" onclick="alert('כיתה ג - בקרוב!')">כיתה ג׳</button>
    <button class="grade-btn" onclick="alert('כיתה ד - בקרוב!')">כיתה ד׳</button>
    <button class="grade-btn" onclick="alert('כיתה ה - בקרוב!')">כיתה ה׳</button>
    <button class="grade-btn" onclick="alert('כיתה ו - בקרוב!')">כיתה ו׳</button>
  </div>

  <div style="text-align: center; margin-top: 3rem; padding: 2rem; background: rgba(255,255,255,0.1); border-radius: 15px;">
    <h3>🚀 האתר בשלבי פיתוח מתקדמים</h3>
    <p>פלטפורמה מהפכנית עם AI, PWA מלא, ונגישות לכל ילד בישראל</p>
    <p style="margin-top: 1rem; font-size: 0.9rem; opacity: 0.8;">נבנה במיוחד לילדי הפריפריה ולשוויון חינוכי</p>
  </div>
</div>

<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/sw.js')
    .then(() => console.log('SW registered'))
    .catch(err => console.log('SW failed'));
}
</script>
</body>
</html>
EOF

      - name: Create Manifest
        run: |
          cat > manifest.json << 'EOF'
{
  "name": "ABC English Explorer",
  "short_name": "ABC Explorer", 
  "start_url": "/",
  "display": "standalone",
  "background_color": "#4FC3F7",
  "theme_color": "#4FC3F7",
  "icons": [
    {
      "src": "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><rect width='192' height='192' fill='%234FC3F7' rx='35'/><text x='96' y='135' font-size='110' text-anchor='middle' fill='white'>🤖</text></svg>",
      "sizes": "192x192",
      "type": "image/svg+xml"
    }
  ]
}
EOF

      - name: Create Service Worker
        run: |
          cat > sw.js << 'EOF'
const CACHE_NAME = 'abc-v1';
const urlsToCache = ['/', '/index.html', '/manifest.json'];

self.addEventListener('install', event => {
  event.waitUntil(
    caches.open(CACHE_NAME).then(cache => cache.addAll(urlsToCache))
  );
});

self.addEventListener('fetch', event => {
  event.respondWith(
    caches.match(event.request).then(response => 
      response || fetch(event.request)
    )
  );
});
EOF

      - name: Create Sample Lesson
        run: |
          cat > lessons/grade1/lesson1.json << 'EOF'
{
  "id": "grade1_lesson1",
  "title": "אותיות A-C",
  "vocabulary": [
    {"word": "Apple", "hebrew": "תפוח"},
    {"word": "Ball", "hebrew": "כדור"}, 
    {"word": "Cat", "hebrew": "חתול"}
  ]
}
EOF

      - name: Commit Files
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add .
          git commit -m "🚀 ABC English Explorer Launch" || exit 0
          git push

      - name: Setup Pages
        uses: actions/configure-pages@v4

      - name: Upload Pages
        uses: actions/upload-pages-artifact@v3
        with:
          path: .

      - name: Deploy Pages
        id: deployment
        uses: actions/deploy-pages@v4

      - name: Success
        run: |
          echo "🎉 ABC English Explorer is LIVE!"
          echo "🌐 URL: ${{ steps.deployment.outputs.page_url }}"
