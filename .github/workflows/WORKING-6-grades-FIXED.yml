name: ✅ ABC Explorer - WORKING 6 Grades FIXED

on:
  workflow_dispatch:
    inputs:
      deploy:
        description: 'Deploy site? (type "DEPLOY")'
        required: true
        default: 'NO'

permissions:
  contents: write
  pages: write
  id-token: write

concurrency:
  group: working-fix
  cancel-in-progress: true

jobs:
  deploy:
    runs-on: ubuntu-latest
    if: github.event.inputs.deploy == 'DEPLOY'
    
    environment:
      name: github-pages
      url: ${{ steps.deploy.outputs.page_url }}

    steps:
      - name: 🔥 Total cleanup
        run: |
          rm -rf * .* 2>/dev/null || true
          echo "✅ Cleaned everything"

      - name: 🎨 Create CSS
        run: |
          cat > style.css << 'EOF'
          body { font-family: Arial, sans-serif; background: linear-gradient(135deg, #667eea, #764ba2); color: #333; direction: rtl; margin: 0; padding: 20px; min-height: 100vh; }
          .container { max-width: 1000px; margin: 0 auto; background: rgba(255,255,255,0.95); border-radius: 20px; padding: 30px; }
          h1 { color: #667eea; text-align: center; margin-bottom: 30px; font-size: 2.5rem; }
          .stats { background: #4CAF50; color: white; padding: 20px; border-radius: 15px; text-align: center; margin: 20px 0; }
          .grades { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 30px 0; }
          .grade { padding: 25px; border-radius: 15px; color: white; cursor: pointer; text-align: center; transition: transform 0.3s; }
          .grade:hover { transform: translateY(-5px); }
          .units { display: grid; gap: 15px; margin: 20px 0; }
          .unit { background: #f8fafc; padding: 20px; border-radius: 10px; border: 2px solid #e2e8f0; }
          .words { display: grid; grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)); gap: 8px; margin: 15px 0; }
          .word { background: #e3f2fd; padding: 8px; border-radius: 6px; text-align: center; font-weight: 500; cursor: pointer; }
          .word:hover { background: #bbdefb; }
          .btn { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 10px 20px; border: none; border-radius: 20px; cursor: pointer; margin: 5px; font-weight: 600; }
          .btn:hover { transform: translateY(-2px); }
          .back { background: linear-gradient(135deg, #e74c3c, #c0392b); }
          @media (max-width: 768px) { .container { padding: 15px; } .grades { grid-template-columns: 1fr; } }
          EOF

      - name: 📚 Create complete working site
        run: |
          cat > index.html << 'ENDHTML'
          <!DOCTYPE html>
          <html lang="he" dir="rtl">
          <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>ABC English Explorer - All 6 Grades Working</title>
            <link rel="stylesheet" href="style.css">
          </head>
          <body>
            <div class="container" id="app"></div>
            
            <script>
            // 🎯 COMPLETE DATA - ALL 6 GRADES WORKING
            const ALL_GRADES = [
              {
                name: "כיתה א'",
                color: "linear-gradient(135deg, #FF6B6B, #FF5252)",
                icon: "🌟",
                units: [
                  { title: "היכרות", words: ["hello", "hi", "bye", "yes", "no", "please", "thank", "you", "sorry", "excuse", "me", "welcome"] },
                  { title: "משפחה", words: ["mom", "dad", "sister", "brother", "baby", "family", "grandpa", "grandma", "uncle", "aunt", "cousin", "friend"] },
                  { title: "צבעים", words: ["red", "blue", "green", "yellow", "black", "white", "pink", "orange", "brown", "purple", "gray", "silver"] },
                  { title: "מספרים", words: ["one", "two", "three", "four", "five", "six", "seven", "eight", "nine", "ten", "eleven", "twelve"] },
                  { title: "גוף", words: ["head", "eye", "nose", "mouth", "ear", "hand", "foot", "arm", "leg", "finger", "toe", "hair"] },
                  { title: "בית", words: ["house", "room", "kitchen", "bedroom", "bathroom", "living", "door", "window", "table", "chair", "bed", "sofa"] }
                ]
              },
              {
                name: "כיתה ב'",
                color: "linear-gradient(135deg, #4ECDC4, #26C6DA)",
                icon: "🦋",
                units: [
                  { title: "חיות", words: ["cat", "dog", "bird", "fish", "rabbit", "horse", "cow", "sheep", "pig", "chicken", "duck", "goat"] },
                  { title: "מזון", words: ["apple", "banana", "bread", "milk", "water", "juice", "cake", "pizza", "ice", "cream", "cookie", "sandwich"] },
                  { title: "בגדים", words: ["shirt", "pants", "dress", "shoes", "socks", "hat", "coat", "jacket", "belt", "tie", "gloves", "scarf"] },
                  { title: "טבע", words: ["tree", "flower", "grass", "leaf", "sun", "moon", "star", "cloud", "rain", "snow", "wind", "sky"] },
                  { title: "תחבורה", words: ["car", "bus", "train", "plane", "bike", "boat", "truck", "taxi", "motorcycle", "helicopter", "rocket", "ship"] },
                  { title: "זמן", words: ["morning", "afternoon", "evening", "night", "today", "yesterday", "tomorrow", "week", "month", "year", "hour", "minute"] }
                ]
              },
              {
                name: "כיתה ג'",
                color: "linear-gradient(135deg, #45B7D1, #1E88E5)",
                icon: "🎓",
                units: [
                  { title: "בי״ס", words: ["school", "teacher", "student", "classroom", "lesson", "homework", "test", "book", "pencil", "paper", "desk", "board"] },
                  { title: "עבודה", words: ["job", "work", "doctor", "nurse", "police", "firefighter", "cook", "driver", "farmer", "artist", "scientist", "engineer"] },
                  { title: "ספורט", words: ["football", "basketball", "tennis", "swimming", "running", "jumping", "playing", "dancing", "singing", "drawing", "reading", "writing"] },
                  { title: "מקומות", words: ["city", "town", "village", "street", "park", "hospital", "store", "library", "zoo", "beach", "mountain", "forest"] },
                  { title: "רגשות", words: ["happy", "sad", "angry", "excited", "tired", "hungry", "thirsty", "scared", "brave", "proud", "shy", "curious"] },
                  { title: "פעולות", words: ["eat", "drink", "sleep", "wake", "walk", "run", "jump", "sit", "stand", "look", "listen", "speak"] }
                ]
              },
              {
                name: "כיתה ד'",
                color: "linear-gradient(135deg, #96CEB4, #4CAF50)",
                icon: "🌱",
                units: [
                  { title: "טכנולוגיה", words: ["computer", "phone", "internet", "email", "website", "message", "call", "video", "photo", "camera", "television", "radio"] },
                  { title: "בריאות", words: ["healthy", "sick", "medicine", "hospital", "treatment", "pain", "fever", "cough", "headache", "exercise", "doctor", "dentist"] },
                  { title: "קניות", words: ["money", "buy", "sell", "price", "expensive", "cheap", "market", "store", "shopping", "customer", "receipt", "change"] },
                  { title: "נסיעות", words: ["travel", "trip", "vacation", "hotel", "airport", "passport", "luggage", "ticket", "map", "direction", "journey", "adventure"] },
                  { title: "מזג אויר", words: ["weather", "sunny", "cloudy", "rainy", "snowy", "windy", "hot", "cold", "warm", "cool", "storm", "rainbow"] },
                  { title: "חגים", words: ["party", "celebration", "birthday", "gift", "present", "cake", "balloon", "music", "dance", "song", "fun", "joy"] }
                ]
              },
              {
                name: "כיתה ה'",
                color: "linear-gradient(135deg, #FFEAA7, #FDCB6E)",
                icon: "⭐",
                units: [
                  { title: "רגשות מתקדמים", words: ["confident", "nervous", "worried", "proud", "embarrassed", "surprised", "disappointed", "grateful", "amazed", "confused", "relaxed", "stressed"] },
                  { title: "חינוך", words: ["education", "knowledge", "skill", "talent", "practice", "improve", "learn", "study", "teach", "explain", "understand", "remember"] },
                  { title: "קהילה", words: ["community", "neighbor", "friendship", "cooperation", "help", "share", "respect", "kindness", "honesty", "trust", "responsibility", "leadership"] },
                  { title: "סביבה", words: ["environment", "nature", "pollution", "recycle", "protect", "clean", "green", "earth", "planet", "wildlife", "forest", "ocean"] },
                  { title: "מדע", words: ["science", "research", "experiment", "discovery", "invention", "technology", "laboratory", "theory", "fact", "evidence", "result", "conclusion"] },
                  { title: "אמנות", words: ["art", "painting", "drawing", "sculpture", "music", "theater", "dance", "creative", "beautiful", "ugly", "design", "color"] }
                ]
              },
              {
                name: "כיתה ו'",
                color: "linear-gradient(135deg, #DDA0DD, #BA68C8)",
                icon: "🎯",
                units: [
                  { title: "מנהיגות", words: ["leadership", "responsibility", "decision", "choice", "influence", "power", "authority", "control", "manage", "organize", "plan", "guide"] },
                  { title: "כלכלה", words: ["business", "company", "economy", "market", "competition", "profit", "investment", "entrepreneur", "success", "failure", "growth", "development"] },
                  { title: "תקשורת", words: ["communication", "language", "conversation", "discussion", "debate", "opinion", "agreement", "argument", "negotiate", "persuade", "convince", "express"] },
                  { title: "גלובליזציה", words: ["global", "international", "culture", "diversity", "tolerance", "understanding", "cooperation", "exchange", "connection", "relationship", "partnership", "unity"] },
                  { title: "יצירתיות", words: ["creativity", "imagination", "inspiration", "original", "innovative", "artistic", "design", "invent", "create", "build", "make", "produce"] },
                  { title: "ערכים", words: ["values", "ethics", "morality", "honesty", "integrity", "justice", "fairness", "equality", "freedom", "dignity", "compassion", "wisdom"] }
                ]
              }
            ];

            // Profile
            let profile = { name: "תלמיד", xp: 0, completed: [] };

            // Current state
            let currentGrade = null;

            // Load profile
            function loadProfile() {
              const saved = localStorage.getItem('abc_profile_fixed');
              if (saved) {
                try { profile = {...profile, ...JSON.parse(saved)}; } catch(e) {}
              }
            }

            // Save profile
            function saveProfile() {
              localStorage.setItem('abc_profile_fixed', JSON.stringify(profile));
            }

            // Show home
            function showHome() {
              currentGrade = null;
              const totalWords = ALL_GRADES.length * 6 * 12; // 6 grades × 6 units × 12 words = 432
              const learnedWords = profile.completed.length * 12;
              const progress = Math.round((learnedWords / totalWords) * 100);

              document.getElementById('app').innerHTML = `
                <h1>🎓 ABC English Explorer</h1>
                
                <div class="stats">
                  <h2>🌟 כל 6 הכיתות זמינות ללמידה!</h2>
                  <p><strong>6 כיתות • 36 יחידות • 432 מילים</strong></p>
                  <p>התקדמות: ${learnedWords}/${totalWords} מילים (${progress}%)</p>
                  <p>נקודות: <strong>${profile.xp}</strong> XP</p>
                </div>

                <div class="grades">
                  ${ALL_GRADES.map((grade, index) => {
                    const gradeCompleted = profile.completed.filter(c => c.startsWith(`g${index}-`)).length;
                    const gradeTotal = 6; // 6 units per grade
                    
                    return `
                      <div class="grade" style="background: ${grade.color};" onclick="showGrade(${index})">
                        <div style="font-size: 3rem; margin-bottom: 15px;">${grade.icon}</div>
                        <h2>${grade.name}</h2>
                        <p style="margin: 15px 0;">6 יחידות • 72 מילים</p>
                        <div style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px;">
                          הושלמו: ${gradeCompleted}/${gradeTotal} יחידות
                        </div>
                      </div>
                    `;
                  }).join('')}
                </div>

                <div style="text-align: center; margin: 30px 0;">
                  <button class="btn" onclick="showProfile()">👤 פרופיל (${profile.xp} נקודות)</button>
                  <button class="btn" onclick="showStats()">📊 סטטיסטיקות</button>
                  <button class="btn" onclick="exportData()">💾 ייצוא נתונים</button>
                </div>
              `;
            }

            // Show grade
            function showGrade(gradeIndex) {
              currentGrade = gradeIndex;
              const grade = ALL_GRADES[gradeIndex];
              
              document.getElementById('app').innerHTML = `
                <h1>${grade.icon} ${grade.name}</h1>
                
                <div class="stats">
                  <h3>6 יחידות לימוד • 72 מילים חדשות</h3>
                  <p>לחץ על מילה כדי לשמוע הגייה • השלם יחידות לקבלת נקודות</p>
                </div>

                <div style="text-align: center; margin: 20px 0;">
                  <button class="btn back" onclick="showHome()">🏠 חזור לדף הבית</button>
                </div>

                <div class="units">
                  ${grade.units.map((unit, unitIndex) => {
                    const unitKey = `g${gradeIndex}-u${unitIndex}`;
                    const isCompleted = profile.completed.includes(unitKey);
                    
                    return `
                      <div class="unit">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                          <h3>📖 יחידה ${unitIndex + 1}: ${unit.title}</h3>
                          <span style="color: ${isCompleted ? '#4CAF50' : '#FF9800'}; font-weight: 600;">
                            ${isCompleted ? '✅ הושלמה' : '⏳ ממתינה'}
                          </span>
                        </div>

                        <div class="words">
                          ${unit.words.map((word, wordIndex) => `
                            <div class="word" onclick="pronounce('${word}')" title="לחץ לשמיעה">
                              <div style="font-weight: 600;">${word}</div>
                              <div style="font-size: 0.8rem; color: #666;">#${wordIndex + 1}</div>
                            </div>
                          `).join('')}
                        </div>

                        <div style="margin-top: 15px; text-align: center;">
                          <button class="btn" onclick="playGame('memory', ${gradeIndex}, ${unitIndex})">🧠 זיכרון</button>
                          <button class="btn" onclick="playGame('quiz', ${gradeIndex}, ${unitIndex})">❓ חידון</button>
                          <button class="btn" onclick="playGame('match', ${gradeIndex}, ${unitIndex})">🎯 התאמה</button>
                          <button class="btn" onclick="completeUnit('${unitKey}', ${gradeIndex}, ${unitIndex})" 
                                  style="background: ${isCompleted ? '#4CAF50' : '#FF9800'};">
                            ${isCompleted ? '🔄 תרגל שוב' : '📚 השלם יחידה'}
                          </button>
                        </div>
                      </div>
                    `;
                  }).join('')}
                </div>
              `;
            }

            // Play game
            function playGame(gameType, gradeIndex, unitIndex) {
              const grade = ALL_GRADES[gradeIndex];
              const unit = grade.units[unitIndex];
              
              const games = {
                memory: '🧠 משחק זיכרון',
                quiz: '❓ חידון אנגלית', 
                match: '🎯 התאמה'
              };
              
              alert(`${games[gameType]}\n\n${grade.name} - יחידה ${unitIndex + 1}\nנושא: ${unit.title}\n\nמילים: ${unit.words.slice(0,6).join(', ')}\n\n🎮 זהו דמו - המשחק המלא בפיתוח!\n+10 נקודות!`);
              
              profile.xp += 10;
              saveProfile();
              showNotification('🎮 +10 נקודות XP!');
            }

            // Complete unit
            function completeUnit(unitKey, gradeIndex, unitIndex) {
              const grade = ALL_GRADES[gradeIndex];
              const unit = grade.units[unitIndex];
              
              if (!profile.completed.includes(unitKey)) {
                profile.completed.push(unitKey);
                profile.xp += 50;
                
                alert(`🎉 יחידה הושלמה!\n\n${grade.name} - יחידה ${unitIndex + 1}\n${unit.title}\n\n12 מילים חדשות נוספו!\n+50 נקודות XP!\n\nסה"כ: ${profile.xp} נקודות`);
                
                checkAchievements();
              } else {
                alert(`🔄 תרגול נוסף!\n\n${unit.title}\nמילים: ${unit.words.join(' • ')}\n\n+15 נקודות!`);
                profile.xp += 15;
              }
              
              saveProfile();
              showGrade(gradeIndex);
            }

            // Pronounce word
            function pronounce(word) {
              if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(word);
                utterance.lang = 'en-US';
                utterance.rate = 0.8;
                speechSynthesis.speak(utterance);
              }
              showNotification(`🔊 ${word}`);
            }

            // Show profile
            function showProfile() {
              const totalUnits = ALL_GRADES.length * 6; // 36 units
              const completedUnits = profile.completed.length;
              const progress = Math.round((completedUnits / totalUnits) * 100);
              const level = Math.floor(profile.xp / 100) + 1;

              document.getElementById('app').innerHTML = `
                <h1>👤 ${profile.name}</h1>
                
                <div class="stats">
                  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 20px;">
                    <div style="text-align: center;">
                      <div style="font-size: 2rem; font-weight: bold;">${profile.xp}</div>
                      <div>נקודות XP</div>
                    </div>
                    <div style="text-align: center;">
                      <div style="font-size: 2rem; font-weight: bold;">${level}</div>
                      <div>רמה</div>
                    </div>
                    <div style="text-align: center;">
                      <div style="font-size: 2rem; font-weight: bold;">${completedUnits}</div>
                      <div>יחידות</div>
                    </div>
                    <div style="text-align: center;">
                      <div style="font-size: 2rem; font-weight: bold;">${completedUnits * 12}</div>
                      <div>מילים</div>
                    </div>
                  </div>
                  <p style="margin-top: 15px;">התקדמות: ${completedUnits}/${totalUnits} יחידות (${progress}%)</p>
                </div>

                <div style="background: #f8fafc; padding: 20px; border-radius: 15px; margin: 20px 0;">
                  <h3>התקדמות לפי כיתות:</h3>
                  ${ALL_GRADES.map((grade, index) => {
                    const gradeCompleted = profile.completed.filter(c => c.startsWith(`g${index}-`)).length;
                    const gradePercent = Math.round((gradeCompleted / 6) * 100);
                    
                    return `
                      <div style="margin: 10px 0;">
                        <div style="display: flex; justify-content: space-between;">
                          <span>${grade.icon} ${grade.name}</span>
                          <span>${gradeCompleted}/6 (${gradePercent}%)</span>
                        </div>
                        <div style="background: #e0e0e0; height: 10px; border-radius: 5px; margin-top: 5px;">
                          <div style="background: ${grade.color}; width: ${gradePercent}%; height: 100%; border-radius: 5px;"></div>
                        </div>
                      </div>
                    `;
                  }).join('')}
                </div>

                <div style="text-align: center;">
                  <button class="btn back" onclick="showHome()">🏠 דף הבית</button>
                  <button class="btn" onclick="editName()">✏️ שם</button>
                  <button class="btn" onclick="resetAll()">🔄 איפוס</button>
                </div>
              `;
            }

            // Show stats
            function showStats() {
              const totalWords = 432;
              const learnedWords = profile.completed.length * 12;
              const progress = Math.round((learnedWords / totalWords) * 100);
              
              alert(`📊 סטטיסטיקות מלאות:\n\n• 6 כיתות זמינות\n• 36 יחידות סה"כ\n• 432 מילים ללמידה\n• ${profile.completed.length} יחידות הושלמו\n• ${learnedWords} מילים נלמדו\n• ${progress}% מהתכנית\n• ${profile.xp} נקודות XP\n• רמה ${Math.floor(profile.xp / 100) + 1}`);
            }

            // Export data
            function exportData() {
              const data = { profile, timestamp: new Date().toISOString() };
              const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
              const url = URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.href = url;
              a.download = `abc-backup-${new Date().toISOString().slice(0,10)}.json`;
              a.click();
              showNotification('💾 נתונים יוצאו!');
            }

            // Edit name
            function editName() {
              const newName = prompt('הכנס שם חדש:', profile.name);
              if (newName && newName.trim()) {
                profile.name = newName.trim();
                saveProfile();
                showNotification(`👤 שם שונה ל: ${profile.name}`);
                showProfile();
              }
            }

            // Reset all
            function resetAll() {
              if (confirm('לאפס הכל? פעולה זו לא ניתנת לביטול!')) {
                profile = { name: "תלמיד", xp: 0, completed: [] };
                saveProfile();
                showNotification('🔄 נתונים אופסו');
                showHome();
              }
            }

            // Check achievements
            function checkAchievements() {
              const completed = profile.completed.length;
              if (completed === 1) showNotification('🏆 הישג: יחידה ראשונה!');
              if (completed === 5) showNotification('🏆 הישג: 5 יחידות!');
              if (completed === 18) showNotification('🏆 הישג: חצי דרך!');
              if (completed === 36) showNotification('🏆 הישג: סיימת הכל!');
            }

            // Show notification
            function showNotification(msg) {
              const div = document.createElement('div');
              div.style.cssText = 'position:fixed;top:20px;right:20px;background:#4CAF50;color:white;padding:15px;border-radius:8px;z-index:1000;font-weight:600;';
              div.textContent = msg;
              document.body.appendChild(div);
              setTimeout(() => document.body.removeChild(div), 3000);
            }

            // Initialize
            function init() {
              loadProfile();
              showHome();
              console.log('✅ ABC Explorer loaded - ALL 6 GRADES WORKING!');
            }

            // Start
            init();
            </script>
          </body>
          </html>
          ENDHTML

      - name: 🔧 Setup Pages
        uses: actions/configure-pages@v4

      - name: 📤 Upload
        uses: actions/upload-pages-artifact@v3
        with:
          path: '.'

      - name: 🚀 Deploy
        id: deploy
        uses: actions/deploy-pages@v4

      - name: ✅ Success
        run: |
          echo "🎉 SUCCESS! ABC Explorer with ALL 6 GRADES deployed!"
          echo "🌐 URL: ${{ steps.deploy.outputs.page_url }}"
          echo ""
          echo "✅ WHAT'S INCLUDED:"
          echo "• כיתה א' - 6 יחידות - 72 מילים"
          echo "• כיתה ב' - 6 יחידות - 72 מילים"  
          echo "• כיתה ג' - 6 יחידות - 72 מילים"
          echo "• כיתה ד' - 6 יחידות - 72 מילים"
          echo "• כיתה ה' - 6 יחידות - 72 מילים"
          echo "• כיתה ו' - 6 יחידות - 72 מילים"
          echo "= TOTAL: 432 REAL WORDS!"
